# Values for kube-prometheus-stack (nested under dependency name).
# Resource limits tuned for a 2GB node so Promstack does not use all memory.
#
kube-prometheus-stack:
  # Prometheus: cap memory so node has room for apps + system
  prometheus:
    prometheusSpec:
      retention: 15d
      retentionSize: 5GB
      resources:
        requests:
          memory: "200Mi"
          cpu: "50m"
        limits:
          memory: "350Mi"
          cpu: "200m"
      storageSpec:
        volumeClaimTemplate:
          spec:
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 5Gi

  # Grafana: admin from Secret; limit memory for small nodes
  grafana:
    persistence:
      enabled: true
      size: 5Gi
    resources:
      requests:
        memory: "100Mi"
        cpu: "50m"
      limits:
        memory: "200Mi"
        cpu: "200m"
    admin:
      existingSecret: "grafana-admin"
      userKey: admin-user
      passwordKey: admin-password

  # Alertmanager: small footprint
  alertmanager:
    alertmanagerSpec:
      resources:
        requests:
          memory: "32Mi"
          cpu: "10m"
        limits:
          memory: "64Mi"
          cpu: "100m"

  # kube-state-metrics: light
  kubeStateMetrics:
    resources:
      requests:
        memory: "32Mi"
        cpu: "10m"
      limits:
        memory: "64Mi"
        cpu: "100m"

  # node-exporter (DaemonSet): minimal per node
  prometheus-node-exporter:
    resources:
      requests:
        memory: "20Mi"
        cpu: "10m"
      limits:
        memory: "40Mi"
        cpu: "100m"

  # Optional: allow Prometheus to discover ServiceMonitors in all namespaces
  # prometheus:
  #   prometheusSpec:
  #     serviceMonitorSelectorNilUsesHelmValues: false
  #     podMonitorSelectorNilUsesHelmValues: false
